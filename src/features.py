# -*- coding: utf-8 -*-
"""Untitled2.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/15YEBuUwPqF8Tz_rrS34iAll1kgJy4Ttr
"""

import pandas as pd
import numpy as np
from .data_loader import preprocess_stock_dataframe

def add_technical_features(symbol, start_page, end_page):
    df = preprocess_stock_dataframe(symbol, start_page, end_page)
    df['MA5'] = df['GiaDongCua'].rolling(window=5).mean()
    df['MA10'] = df['GiaDongCua'].rolling(window=10).mean()
    df['MA20'] = df['GiaDongCua'].rolling(window=20).mean()
    df['Volatility_5'] = df['Return'].rolling(window=5).std()
    df['OpenCloseGap'] = df['GiaDongCua'] - df['GiaMoCua']
    df['HighLowRange'] = df['GiaCaoNhat'] - df['GiaThapNhat']
    df['VolumeChange'] = df['KhoiLuongKhopLenh'].pct_change()
    return df.dropna().reset_index(drop=True)

def add_lag_features(df, target_col='GiaDongCua', lags=[1]):
    for lag in lags:
        df[f'{target_col}_lag{lag}'] = df[target_col].shift(lag)
    return df.dropna().reset_index(drop=True)